---
layout: post
title: "AD93xx 芯片手册"
date: 2022-8-17
description: "AD9361 说明手册"
tag: 芯片手册
typora-root-url: ..
---

## 常用术语介绍

- AGC 自动增益控制	MGC 手动增益控制 BBP控制部分或全部增益控制参数

- BBP 基带处理器         BB 基带接收信号，从RF下边频而来， 基带发射信号是那些还未上变频到射频的

- BB DC Cal 基带直流校准--一种片上校准，通过在半带滤波器和接收FIR 滤波器之间的数据中添加数字矫正字来降低接收数据中的直流功率

- DC 直流电，DC指的是接收到的综合体中心的非期望接收功率基带频谱

- ENSM 启动状态机 

- FDD 频分双工，发射和接收信号可以同时存在且使用不同的频率

- LMT LMT增益表以及一个模拟峰值检测器，用于监控模拟LPF输入端的信号电平

- LO 本地振荡器 指接收器和发射器所需的射频载波频率

- LPF 低通滤波器，指接收ADC之前和发送DAC之后的三阶模拟低通滤波器

- LUT 查找表，一些校准和功能取决于读取或存储查找表以供将来使用

- PLL 锁相环 AD9361使用PLL在芯片内部生成各种时钟速率以及Tx和Rx LO 频率

- RF DC Cal 射频直流校准是一种片上校准，它通过在LNA和混频器之间施加补偿电压来降低接收数据中的直流功率。

- TDD 时分双工，其中发送和接收信号可以出现在相同频率上，但出现在不同的时间

- VCO 压控振荡器（VCO）是一种电路，其中振荡器的输出频率由输入电压电平控制。这些VCO是AD9361上PLL的一部分，AD9361必须在VCO产生的频率准确和稳定之前对其进行校准

  

## 基站

无线基站等应用要求参考时钟锁定到系统主时钟，在这种情况下，将VCTCXO等外部振荡器与射频芯片等同步PLL结合使用，然后无线用户设备（UE）通常不需要锁定到主时钟，但它们确实需要定期调整LO频率以保持与基站的连接。基站（BTS）偶尔会通知UE其相对与基站的频率误差，通过调整微调电容，基带处理器可以根据需要调整参考时钟频率，进而调整LO频率。



## 时钟定义

### DCXO设置和操作

要使用DCXO，需要在AD9361的XTALP和XTALN引脚之间连接一个外部晶振（X0）。有效的晶体谐振频率范围为19MHz和50MHz。晶体必须是AT振动模式，负载电容是10pF。



### 参考时钟设计和操作

如果不使用 DCXO，外部参考时钟需要交流耦合到 XTALN（引脚 M12）。 XTALP（引脚 M11）未连接（悬空）。 时钟频率必须在 5 MHz 和 320 MHz 之间，并且可以使用 BBPLL、Rx 和 Tx 参考分频器按 1×、1⁄2×、1⁄4× 和 2× 进行缩放。 RFPLL 鉴相器的有效频率范围为 10 MHz 至 80 MHz，参考时钟的缩放频率必须在此范围内。 为获得最佳相位噪声，建议使用尽可能接近 80 MHz 的缩放时钟。 DCXO 和外部参考时钟之间的选择在 ad9361_init 函数中进行。



### AD9361 PLL结构

如图，主要有参考模块，主PLL模块和LO GEN输出模块组成，VCO始终在6 GHz和12 GHz之间运行

![image-20220817140113479](/images/chips/image-113.png)

参考频率可以通过片上DCXO或者外部时钟源提供给器件。 MUX 选择所需的源。 然后将参考拆分并应用于三个独立的调节块，也称为参考分频器。 调节模块提供四个选项，使 PLL 参考频率 F REF （应用于 PLL 相位检测器的环路参考）被缓冲、加倍、减半或除以 4。独立模块可以有不同的 F RF 和 BBPLL 的 REF。 参考定标器将由 ad9361_init 函数设置。 为获得最佳 RFPLL 性能，建议选择能够尽可能接近 80 MHz 的参考时钟或晶体。



## 滤波器手册

### 发射信号路径

AD9361信号路径从AD9361数字接口接收I-Q格式的12bit二进制补码数据，每个通过（I和Q）将该数据通过四个数字插值滤波器传递到12bitDAC。可以绕过四个插值滤波器中的每一个，DAC的模拟输出在射频混频器之前通过两个低通滤波器。每个低通滤波器的转角频率可通过ad9361_set_tx_rf_bandwidth函数进行编程。

![image-20220817144127380](/images/chips/image-11.png)

### 接收信号路径

AD9361 Rx信号路径将下边频信号（I和Q）传递到基带接收器部分，基带Rx信号路劲可由两个可编程模拟低通滤波器，一个12bitADC和四级数字抽取滤波器组成。如下图

![image-20220817152722739](/images/chips/image-12.png)

Rx FIR配置示例，例如 LTE 10MHz

例如接收器设置为在LTE 10MHz系统中运行，使用40Mhz参考时钟，所有128个FIR滤波器抽头均使用，数据速率设置为15.36MSPS，为了使用给定的参考时钟实现此数据速率，每个数字滤波器（HB3，HB2，HB1和FIR滤波器）都将其抽取因子设置为2，生成的采样时钟如下

- HB3（四阶滤波）-245.76MHz
- HB2（六阶滤波）-122.88MHz
- HB1（十四阶滤波）-61.44MHz
- FIR（128阶滤波）-30.72MHz

这里注意，FIR滤波器是该值最大的组成部分，因为它具有大量的抽头和较低的采样频率。如果FIR滤波器的阶数远大于半带滤波器的阶数，那么粗略估计计算就可以忽略半带滤波器。



## 增益控制

AD9361收发器具有多种增益控制模式，可用于各种应用，全自动增益控制（AGC）模式可用于解决时分双工（TDD）和频分双工（FDD）场景，此外，AD9361具有手动增益控制（MGC）选项，允许BBP控制接收器的增益。ad9361_set_rx_gain_control_mode函数配置所有增益控制模式。

![image-20220817161114669](/images/chips/image-13.png)



